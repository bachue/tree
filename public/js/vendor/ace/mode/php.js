define(function(require,exports,module){"use strict";var oop=require("../lib/oop");var TextMode=require("./text").Mode;var Tokenizer=require("../tokenizer").Tokenizer;var PhpHighlightRules=require("./php_highlight_rules").PhpHighlightRules;var PhpLangHighlightRules=require("./php_highlight_rules").PhpLangHighlightRules;var MatchingBraceOutdent=require("./matching_brace_outdent").MatchingBraceOutdent;var Range=require("../range").Range;var WorkerClient=require("../worker/worker_client").WorkerClient;var CstyleBehaviour=require("./behaviour/cstyle").CstyleBehaviour;var CStyleFoldMode=require("./folding/cstyle").FoldMode;var unicode=require("../unicode");var Mode=function(opts){this.inlinePhp=opts&&opts.inline;var HighlightRules=this.inlinePhp?PhpLangHighlightRules:PhpHighlightRules;this.HighlightRules=HighlightRules;this.$outdent=new MatchingBraceOutdent;this.$behaviour=new CstyleBehaviour;this.foldingRules=new CStyleFoldMode};oop.inherits(Mode,TextMode);(function(){this.tokenRe=new RegExp("^["+unicode.packages.L+unicode.packages.Mn+unicode.packages.Mc+unicode.packages.Nd+unicode.packages.Pc+"_]+","g");this.nonTokenRe=new RegExp("^(?:[^"+unicode.packages.L+unicode.packages.Mn+unicode.packages.Mc+unicode.packages.Nd+unicode.packages.Pc+"_]|s])+","g");this.lineCommentStart=["//","#"];this.blockComment={start:"/*",end:"*/"};this.getNextLineIndent=function(state,line,tab){var indent=this.$getIndent(line);var tokenizedLine=this.getTokenizer().getLineTokens(line,state);var tokens=tokenizedLine.tokens;var endState=tokenizedLine.state;if(tokens.length&&tokens[tokens.length-1].type=="comment"){return indent}if(state=="php-start"){var match=line.match(/^.*[\{\(\[\:]\s*$/);if(match){indent+=tab}}else if(state=="php-doc-start"){if(endState!="php-doc-start"){return""}var match=line.match(/^\s*(\/?)\*/);if(match){if(match[1]){indent+=" "}indent+="* "}}return indent};this.checkOutdent=function(state,line,input){return this.$outdent.checkOutdent(line,input)};this.autoOutdent=function(state,doc,row){this.$outdent.autoOutdent(doc,row)};this.createWorker=function(session){var worker=new WorkerClient(["ace"],"ace/mode/php_worker","PhpWorker");worker.attachToDocument(session.getDocument());if(this.inlinePhp)worker.call("setOptions",[{inline:true}]);worker.on("error",function(e){session.setAnnotations(e.data)});worker.on("ok",function(){session.clearAnnotations()});return worker};this.$id="ace/mode/php"}).call(Mode.prototype);exports.Mode=Mode});