define(function(require,exports,module){"use strict";var oop=require("../lib/oop");var lang=require("../lib/lang");var TextHighlightRules=require("./text_highlight_rules").TextHighlightRules;var JavaScriptHighlightRules=require("./javascript_highlight_rules").JavaScriptHighlightRules;var XmlHighlightRules=require("./xml_highlight_rules").XmlHighlightRules;var HtmlHighlightRules=require("./html_highlight_rules").HtmlHighlightRules;var CssHighlightRules=require("./css_highlight_rules").CssHighlightRules;var escaped=function(ch){return"(?:[^"+lang.escapeRegExp(ch)+"\\\\]|\\\\.)*"};function github_embed(tag,prefix){return{token:"support.function",regex:"^\\s*```"+tag+"\\s*$",push:prefix+"start"}}var MarkdownHighlightRules=function(){HtmlHighlightRules.call(this);this.$rules["start"].unshift({token:"empty_line",regex:"^$",next:"allowBlock"},{token:"markup.heading.1",regex:"^=+(?=\\s*$)"},{token:"markup.heading.2",regex:"^\\-+(?=\\s*$)"},{token:function(value){return"markup.heading."+value.length},regex:/^#{1,6}(?=\s*[^ #]|\s+#.)/,next:"header"},github_embed("(?:javascript|js)","jscode-"),github_embed("xml","xmlcode-"),github_embed("html","htmlcode-"),github_embed("css","csscode-"),{token:"support.function",regex:"^\\s*```\\s*\\S*(?:{.*?\\})?\\s*$",next:"githubblock"},{token:"string.blockquote",regex:"^\\s*>\\s*(?:[*+-]|\\d+\\.)?\\s+",next:"blockquote"},{token:"constant",regex:"^ {0,2}(?:(?: ?\\* ?){3,}|(?: ?\\- ?){3,}|(?: ?\\_ ?){3,})\\s*$",next:"allowBlock"},{token:"markup.list",regex:"^\\s{0,3}(?:[*+-]|\\d+\\.)\\s+",next:"listblock-start"},{include:"basic"});this.addRules({basic:[{token:"constant.language.escape",regex:/\\[\\`*_{}\[\]()#+\-.!]/},{token:"support.function",regex:"(`+)(.*?[^`])(\\1)"},{token:["text","constant","text","url","string","text"],regex:'^([ ]{0,3}\\[)([^\\]]+)(\\]:\\s*)([^ ]+)(\\s*(?:["][^"]+["])?(\\s*))$'},{token:["text","string","text","constant","text"],regex:"(\\[)("+escaped("]")+")(\\]s*\\[)("+escaped("]")+")(\\])"},{token:["text","string","text","markup.underline","string","text"],regex:"(\\[)("+escaped("]")+")(\\]\\()"+'((?:[^\\)\\s\\\\]|\\\\.|\\s(?=[^"]))*)'+'(\\s*"'+escaped('"')+'"\\s*)?'+"(\\))"},{token:"string.strong",regex:"([*]{2}|[_]{2}(?=\\S))(.*?\\S[*_]*)(\\1)"},{token:"string.emphasis",regex:"([*]|[_](?=\\S))(.*?\\S[*_]*)(\\1)"},{token:["text","url","text"],regex:"(<)("+"(?:https?|ftp|dict):[^'\">\\s]+"+"|"+"(?:mailto:)?[-.\\w]+\\@[-a-z0-9]+(?:\\.[-a-z0-9]+)*\\.[a-z]+"+")(>)"}],allowBlock:[{token:"support.function",regex:"^ {4}.+",next:"allowBlock"},{token:"empty",regex:"",next:"start"}],header:[{regex:"$",next:"start"},{include:"basic"},{defaultToken:"heading"}],"listblock-start":[{token:"support.variable",regex:/(?:\[[ x]\])?/,next:"listblock"}],listblock:[{token:"empty_line",regex:"^$",next:"start"},{token:"markup.list",regex:"^\\s{0,3}(?:[*+-]|\\d+\\.)\\s+",next:"listblock-start"},{include:"basic",noEscape:true},{token:"support.function",regex:"^\\s*```\\s*[a-zA-Z]*(?:{.*?\\})?\\s*$",next:"githubblock"},{defaultToken:"list"}],blockquote:[{token:"empty_line",regex:"^\\s*$",next:"start"},{token:"string.blockquote",regex:"^\\s*>\\s*(?:[*+-]|\\d+\\.)?\\s+",next:"blockquote"},{include:"basic",noEscape:true},{defaultToken:"string.blockquote"}],githubblock:[{token:"support.function",regex:"^\\s*```",next:"start"},{token:"support.function",regex:".+"}]});this.embedRules(JavaScriptHighlightRules,"jscode-",[{token:"support.function",regex:"^\\s*```",next:"pop"}]);this.embedRules(HtmlHighlightRules,"htmlcode-",[{token:"support.function",regex:"^\\s*```",next:"pop"}]);this.embedRules(CssHighlightRules,"csscode-",[{token:"support.function",regex:"^\\s*```",next:"pop"}]);this.embedRules(XmlHighlightRules,"xmlcode-",[{token:"support.function",regex:"^\\s*```",next:"pop"}]);this.normalizeRules()};oop.inherits(MarkdownHighlightRules,TextHighlightRules);exports.MarkdownHighlightRules=MarkdownHighlightRules});