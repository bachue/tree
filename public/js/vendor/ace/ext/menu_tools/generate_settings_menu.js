define(function(require,exports,module){"use strict";var egen=require("./element_generator");var addEditorMenuOptions=require("./add_editor_menu_options").addEditorMenuOptions;var getSetFunctions=require("./get_set_functions").getSetFunctions;module.exports.generateSettingsMenu=function generateSettingsMenu(editor){var elements=[];function cleanupElementsList(){elements.sort(function(a,b){var x=a.getAttribute("contains");var y=b.getAttribute("contains");return x.localeCompare(y)})}function wrapElements(){var topmenu=document.createElement("div");topmenu.setAttribute("id","ace_settingsmenu");elements.forEach(function(element){topmenu.appendChild(element)});return topmenu}function createNewEntry(obj,clss,item,val){var el;var div=document.createElement("div");div.setAttribute("contains",item);div.setAttribute("class","ace_optionsMenuEntry");div.setAttribute("style","clear: both;");div.appendChild(egen.createLabel(item.replace(/^set/,"").replace(/([A-Z])/g," $1").trim(),item));if(Array.isArray(val)){el=egen.createSelection(item,val,clss);el.addEventListener("change",function(e){try{editor.menuOptions[e.target.id].forEach(function(x){if(x.textContent!==e.target.textContent){delete x.selected}});obj[e.target.id](e.target.value)}catch(err){throw new Error(err)}})}else if(typeof val==="boolean"){el=egen.createCheckbox(item,val,clss);el.addEventListener("change",function(e){try{obj[e.target.id](!!e.target.checked)}catch(err){throw new Error(err)}})}else{el=egen.createInput(item,val,clss);el.addEventListener("change",function(e){try{if(e.target.value==="true"){obj[e.target.id](true)}else if(e.target.value==="false"){obj[e.target.id](false)}else{obj[e.target.id](e.target.value)}}catch(err){throw new Error(err)}})}el.style.cssText="float:right;";div.appendChild(el);return div}function makeDropdown(item,esr,clss,fn){var val=editor.menuOptions[item];var currentVal=esr[fn]();if(typeof currentVal=="object")currentVal=currentVal.$id;val.forEach(function(valuex){if(valuex.value===currentVal)valuex.selected="selected"});return createNewEntry(esr,clss,item,val)}function handleSet(setObj){var item=setObj.functionName;var esr=setObj.parentObj;var clss=setObj.parentName;var val;var fn=item.replace(/^set/,"get");if(editor.menuOptions[item]!==undefined){elements.push(makeDropdown(item,esr,clss,fn))}else if(typeof esr[fn]==="function"){try{val=esr[fn]();if(typeof val==="object"){val=val.$id}elements.push(createNewEntry(esr,clss,item,val))}catch(e){}}}addEditorMenuOptions(editor);getSetFunctions(editor).forEach(function(setObj){handleSet(setObj)});cleanupElementsList();return wrapElements()}});